"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7331],{34275:function(e,r,t){t.d(r,{v:function(){return a}});var n=t(17674),i=t(17e3),o=t(31001),u=t(13613),c=t(87899),a=function(e){var r=e.marketId,t=e.positions,a=void 0===t?[]:t,s=e.enabled,d=void 0===s||s,l=(0,u.z)().yldrLeverageAutomationsService,f=(0,c.Yh)((function(e){return[e.currentChainId,e.isMarketsReady,e.getMarketDataById(r)]})),m=(0,n.Z)(f,3),p=m[0],v=m[1],b=m[2],k=b.addresses.leverageAutomationsAddress;return(0,i.a)({queryFn:function(){return l.getConfiguredAutomations(p,k,a)},queryKey:[o.iP.YLDR_LEVERAGE_AUTOMATIONS,p,r,k,a],enabled:Boolean(b.marketId&&k&&a.length)&&v&&d,refetchInterval:o.g_})}},52064:function(e,r,t){t.d(r,{q:function(){return N}});var n=t(59499),i=t(4730),o=t(17674),u=t(17e3),c=t(13613),a=t(87899),s=t(31001),d=t(49486),l=t(50029),f=t(87794),m=t.n(f),p=t(46930);function v(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function b(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?v(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var k=[],y=!1,h=function(){var e=(0,l.Z)(m().mark((function e(r,t,n){var i,o,u;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i="".concat(n,"/erc721/owned_tokens/").concat(r,"?chain_id=").concat(t),e.next=4,fetch(i);case 4:return o=e.sent,e.next=7,o.json();case 7:return u=e.sent,e.abrupt("return",u);case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(r,t,n){return e.apply(this,arguments)}}(),g=["data"];function O(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function P(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?O(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var C=[],N=function(e){var r=(0,c.z)().uiPositionService,t=function(){var e=(0,p.f)().currentNetworkConfig,r=(0,a.Yh)((function(e){return[e.account,e.currentChainId,e.getCurrentChainMarketData()]})),t=(0,o.Z)(r,3),n=t[0],i=t[1],c=t[2],d=e.yldrYpiUrl;return(0,u.a)({queryFn:function(){return h(n,i,d)},queryKey:[s.iP.POSITIONS,n,i],enabled:Boolean(n),initialData:k,refetchInterval:s.hB,onSuccess:function(e){var r=e.map((function(e){return e.token_id}));r.length&&!y&&(window.gtag("event","user_has_uniswap_positions",{tokenIds:r}),y=!0)},select:function(e){return e.map((function(e){var r,t;return b(b({},e),{},{market_id:null===(r=c.find((function(r){return r.addresses.positionManagerAddress===e.contract_address})))||void 0===r?void 0:r.marketId,market_name:null===(t=c.find((function(r){return r.addresses.positionManagerAddress===e.contract_address})))||void 0===t?void 0:t.marketName})}))}})}(),n=t.data,l=t.isLoading,f=(0,a.Yh)((function(e){return[e.currentChainId,e.isMarketsReady,e.getCurrentChainMarketData()]})),m=(0,o.Z)(f,3),v=m[0],O=m[1],N=m[2],w=null!==e&&void 0!==e&&e.length?e:n.map((function(e){return e.token_id.toString()})),Z=(0,u.a)({queryKey:[s.iP.POSITIONS_DATA,v,w],queryFn:function(){var e=n.filter((function(e){return w.includes(e.token_id.toString())})).map((function(e){return e.contract_address})).filter((function(e,r,t){return e&&t.indexOf(e)===r})).map((function(e){var t=n.filter((function(e){return w.includes(e.token_id.toString())})).filter((function(r){return r.contract_address===e})).map((function(e){return e.token_id})),i=function(e,r){var t;return null===(t=e.find((function(e){return e.addresses.positionManagerAddress===r})))||void 0===t?void 0:t.addresses.dataProviderAddress}(N,e);return i?r.getPositionsData(v,i,t):Promise.reject()}));return Promise.all(e)},enabled:O&&!l,refetchInterval:s.g_,keepPreviousData:!Boolean(null===e||void 0===e?void 0:e.length),select:function(e){return e.reduce((function(e,r){return r.forEach((function(r){var t,i;e.push(P(P({},r),{},{controlType:d.N3.ManualPosition,marketId:null===(t=n.find((function(e){return e.token_id===r.tokenId.toNumber()})))||void 0===t?void 0:t.market_id,marketName:null===(i=n.find((function(e){return e.token_id===r.tokenId.toNumber()})))||void 0===i?void 0:i.market_name,tokenId:r.tokenId.toNumber(),fee0:r.fee0.toString(),fee1:r.fee1.toString(),amount0:r.amount0.toString(),amount1:r.amount1.toString()}))})),e}),[])}}),A=Z.data,I=(0,i.Z)(Z,g);return P({data:A||C},I)}},98924:function(e,r,t){t.d(r,{Aj:function(){return g},vH:function(){return y},Jc:function(){return h}});var n=t(59499),i=t(27484),o=t.n(i),u=t(70794),c=t(65216),a=t(11288),s=t(37920),d=t(49486),l=t(41551),f=t(35374),m=function(e,r,t){return(0,u.Z)(e).div((0,u.Z)(10).pow(r)).multipliedBy((0,u.Z)(t).div((0,u.Z)(10).pow(a.$3)))},p=t(78934),v=t(66771);function b(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function k(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?b(Object(t),!0).forEach((function(r){(0,n.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):b(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}var y=function(e,r){if(r){var t=(0,v.pF)(e,o()().unix()),n=t.find((function(e){var t=e.underlyingAsset;return(0,c.toChecksumAddress)(t)===(0,c.toChecksumAddress)(r.token0)})),i=t.find((function(e){var t=e.underlyingAsset;return(0,c.toChecksumAddress)(t)===(0,c.toChecksumAddress)(r.token1)}));if(n&&i){var s=(0,u.Z)(r.fee).div(1e4),b=(0,u.Z)(n.reserveLiquidationThreshold).div(1e4),y=(0,u.Z)(i.reserveLiquidationThreshold).div(1e4),h=u.Z.min(b,y),g=u.Z.max((0,u.Z)(n.reserveLiquidationBonus).div(1e4),(0,u.Z)(i.reserveLiquidationBonus).div(1e4)),O=m(r.amount0,n.decimals,n.priceInMarketReferenceCurrency),P=m(r.amount1,i.decimals,i.priceInMarketReferenceCurrency),C=O.plus(P),N=(0,u.Z)(n.baseLTVasCollateral).div(1e4),w=(0,u.Z)(i.baseLTVasCollateral).div(1e4),Z=u.Z.min(N,w),A=m(n.availableLiquidity,n.decimals,n.priceInMarketReferenceCurrency),I=m(i.availableLiquidity,i.decimals,i.priceInMarketReferenceCurrency),j=(0,u.Z)(1).div((0,u.Z)(1).minus(Z)).multipliedBy(.99),R=u.Z.min(j,A.div(C).plus(1)),_=u.Z.min(j,I.div(C).plus(1)),M=(0,p.p)(r.amount0,n.decimals),D=(0,p.p)(r.amount1,i.decimals),B=(0,p.p)(r.fee0,n.decimals),q=(0,p.p)(r.fee1,i.decimals),S=(0,p.p)(n.priceInMarketReferenceCurrency,a.$3),L=(0,p.p)(i.priceInMarketReferenceCurrency,a.$3),F=M.plus(B),T=D.plus(q),E=F.multipliedBy(S),W=T.multipliedBy(L),x=(0,f.N)(r.tickLower,n.decimals,i.decimals),U=(0,f.N)(r.tickUpper,n.decimals,i.decimals),V=r.sqrtPriceX96.toString(),Y=(0,u.Z)(V).multipliedBy(V).multipliedBy((0,u.Z)(10).pow(n.decimals)).div((0,u.Z)(10).pow(i.decimals)).div((0,u.Z)(2).pow(192)),$=(0,u.Z)(1).div(Y),G=r.tickCurrent>=r.tickLower&&r.tickCurrent<=r.tickUpper,K=r.fee,z=E.plus(W);return k(k({},r),{},{type:d.Tw.Position,fee:s.toNumber(),ltv:Z.toNumber(),liquidationThreshold:h.toNumber(),liquidationBonus:g.toNumber(),lowerPosition:x,upperPosition:U,positionInRange:G,token0:k(k({},n),{},{underlyingAsset:(0,c.toChecksumAddress)(r.token0),decimals:n.decimals,marketReferenceCurrencyValue:O.toNumber(),availableLeverage:R.toNumber(),liquidity:M.toNumber(),priceInMarketReferenceCurrency:S.toNumber(),fee:B.toNumber(),marketReferenceCurrencyFee:m(r.fee0,n.decimals,n.priceInMarketReferenceCurrency).toNumber(),netWorth:F.toNumber(),netWorthUsd:E.toNumber(),liquidationThreshold:b.toNumber()},(0,l.QD)(n)),token1:k(k({},i),{},{underlyingAsset:(0,c.toChecksumAddress)(i.underlyingAsset),decimals:i.decimals,marketReferenceCurrencyValue:P.toNumber(),availableLeverage:_.toNumber(),liquidity:D.toNumber(),priceInMarketReferenceCurrency:L.toNumber(),fee:q.toNumber(),marketReferenceCurrencyFee:m(r.fee1,i.decimals,i.priceInMarketReferenceCurrency).toNumber(),netWorth:T.toNumber(),netWorthUsd:W.toNumber(),liquidationThreshold:y.toNumber()},(0,l.QD)(i)),maxLeverage:j.toNumber(),availableLeverage:u.Z.max(R,_).toNumber(),marketReferenceCurrencyValue:C.toNumber(),collateral:z,poolPrice:Y,invertedPoolPrice:$,feeAmount:K})}}},h=function(e,r){return r.reduce((function(r,t){var n=y(e,t);return n&&r.push(n),r}),[])},g=function(e,r){return r.reduce((function(r,t){var n=y(e,t.uniswapV3Position),i=(0,v.Rp)(e).find((function(e){var r=e.underlyingAsset;return(0,c.toChecksumAddress)(r)===t.debtAsset}));if(n&&i){var o=(0,p.p)(t.debt,i.decimals),l=(0,p.p)(t.revenueFee0,n.token0.decimals),f=(0,p.p)(t.revenueFee1,n.token1.decimals),m=t.revenueFeePercent,b=(0,u.Z)(n.token0.fee).minus(l),h=(0,u.Z)(n.token1.fee).minus(f),g=(0,u.Z)(n.token0.marketReferenceCurrencyFee).minus(l.multipliedBy(n.token0.priceInMarketReferenceCurrency)),O=(0,u.Z)(n.token1.marketReferenceCurrencyFee).minus(f.multipliedBy(n.token1.priceInMarketReferenceCurrency)),P=o.multipliedBy(i.priceInMarketReferenceCurrency).div((0,u.Z)(10).pow(a.$3)),C=(0,u.Z)(n.token0.netWorth).minus((0,c.toChecksumAddress)(i.underlyingAsset)===n.token0.underlyingAsset?o:0),N=(0,u.Z)(n.token1.netWorth).minus((0,c.toChecksumAddress)(i.underlyingAsset)===n.token1.underlyingAsset?o:0),w=(0,u.Z)((0,s.G)({rate:i.variableBorrowRate,duration:a.E_}).toString()).div((0,u.Z)(10).pow(25)).div(100),Z=(0,u.Z)(n.marketReferenceCurrencyValue).multipliedBy(n.liquidationThreshold).div(P),A=(0,u.Z)(n.marketReferenceCurrencyDebt||0).div(n.collateral||0).isGreaterThanOrEqualTo(n.ltv);r.push(k(k({},n),{},{type:d.Tw.LeveragedPosition,positionAddress:t.positionAddress,token0:k(k({},n.token0),{},{fee:b.toNumber(),marketReferenceCurrencyFee:g.toNumber(),netWorth:C.toNumber(),netWorthUsd:C.multipliedBy(n.token0.priceInMarketReferenceCurrency).toNumber()}),token1:k(k({},n.token1),{},{fee:h.toNumber(),marketReferenceCurrencyFee:O.toNumber(),netWorth:N.toNumber(),netWorthUsd:N.multipliedBy(n.token1.priceInMarketReferenceCurrency).toNumber()}),debtToken:i,debtAsset:(0,c.toChecksumAddress)(t.debtAsset),debtWithoutDecimals:t.debt,marketReferenceCurrencyDebt:P.toNumber(),debt:o.toNumber(),revenueFee0:l.toFixed(),revenueFee1:f.toFixed(),borrowApy:w.toNumber(),healthFactor:Z.toNumber(),revenueFeePercent:m,lowHealthFactor:A}))}return r}),[])}},49486:function(e,r,t){var n,i,o;t.d(r,{y6:function(){return n},Tw:function(){return i},N3:function(){return o}}),function(e){e.all="all",e.stable="stable",e.volatile="volatile"}(n||(n={})),function(e){e.Pool="Pool",e.Position="Position",e.LeveragedPosition="LeveragedPosition"}(i||(i={})),function(e){e.Unknown="Unknown",e.ManualPosition="ManualPosition",e.AlmPosition="AlmPosition"}(o||(o={}))},91327:function(e,r,t){t.d(r,{B:function(){return n},q:function(){return i}});var n=1.0001,i=1},35374:function(e,r,t){t.d(r,{N:function(){return o}});var n=t(70794),i=t(91327),o=function(e,r,t){return e&&r&&t?(0,n.Z)(Math.pow(i.B,e)).multipliedBy((0,n.Z)(10).pow(r)).div((0,n.Z)(10).pow(t)).decimalPlaces(8):(0,n.Z)(0)}},18528:function(e,r,t){t.d(r,{v:function(){return i}});var n=t(65216),i=function(e){var r=e.reserves,t=e.address;return r.length&&t?r.find((function(e){return(0,n.toChecksumAddress)(e.underlyingAsset)===(0,n.toChecksumAddress)(t)})):void 0}},78934:function(e,r,t){t.d(r,{p:function(){return i}});var n=t(70794),i=function(e,r){return(0,n.Z)(e||0).div((0,n.Z)(10).pow(r))}}}]);
//# sourceMappingURL=7331-b4cf0f21ea5b16b4.js.map